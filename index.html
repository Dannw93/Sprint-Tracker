<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprint Tracker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Recharts for Charts -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        // Your web app's Firebase configuration
        // IMPORTANT: Please verify these details are correct from your Firebase project settings.
        const firebaseConfig = {
          apiKey: "AIzaSyAnh0elXN7gUi_aevZKLDUmAqMlt1zMuqo",
          authDomain: "athletics-track-fddc0.firebaseapp.com",
          projectId: "athletics-track-fddc0",
          storageBucket: "athletics-track-fddc0.appspot.com",
          messagingSenderId: "486187726074",
          appId: "1:486187726074:web:1c604373a8c7c33a8d4543"
        };

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut
        } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { 
            getFirestore,
            collection,
            onSnapshot,
            addDoc,
            doc,
            updateDoc,
            deleteDoc,
            query,
            orderBy
        } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Make Firebase services globally available to the React app
        window.firebaseServices = { 
            auth, 
            db, 
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            collection,
            onSnapshot,
            addDoc,
            doc,
            updateDoc,
            deleteDoc,
            query,
            orderBy
        };
    </script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            overscroll-behavior-y: contain;
        }
        .prose { max-width: 65ch; color: #374151; }
        .prose h1, .prose h2, .prose h3 { color: #111827; }
        .prose strong { color: #111827; }
        .prose ul > li::before { background-color: #3b82f6; }
        
        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: #d1d5db #f3f4f6;
        }
        .scrollbar-thin::-webkit-scrollbar {
            width: 8px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f3f4f6;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: #d1d5db;
            border-radius: 10px;
            border: 2px solid #f3f4f6;
        }
        .range-thumb::-webkit-slider-thumb{
            -webkit-appearance:none;
            appearance:none;
            width:24px;
            height:24px;
            background:#3b82f6;
            cursor:pointer;
            border-radius:50%;
            border: 4px solid #fff;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.1);
        }
        .range-thumb::-moz-range-thumb{
            width:24px;
            height:24px;
            background:#3b82f6;
            cursor:pointer;
            border-radius:50%;
            border: 4px solid #fff;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ScatterChart, Scatter, ZAxis } = window.Recharts || {};
        const {
            auth, db, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut,
            collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc, query, orderBy
        } = window.firebaseServices;


        // A list of UK athletic tracks with coordinates for the weather API.
        const ukAthleticTracks = [
            { name: "Abingdon Tilsley Park Track", latitude: 51.682, longitude: -1.294 },
            // ... (rest of the tracks)
        ].sort((a, b) => {
            const nameA = typeof a === 'string' ? a : a.name;
            const nameB = typeof b === 'string' ? b : b.name;
            return nameA.localeCompare(nameB);
        });

        function Icon({ name, size = 16, className = "" }) {
            const iconStyle = { width: size, height: size, strokeWidth: 2, stroke: 'currentColor', fill: 'none', strokeLinecap: 'round', strokeLinejoin: 'round' };
            const icons = {
                home: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>,
                plus: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
                check: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><polyline points="20 6 9 17 4 12"></polyline></svg>,
                x: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
                menu: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>,
                timer: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
                calendar: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
                logIn: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg>,
                logOut: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>,
                chevronDown: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><polyline points="6 9 12 15 18 9"></polyline></svg>,
                chevronUp: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><polyline points="18 15 12 9 6 15"></polyline></svg>,
                trash2: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>,
                edit: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
                save: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
                alertTriangle: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>,
                chevronLeft: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><polyline points="15 18 9 12 15 6"></polyline></svg>,
                chevronRight: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><polyline points="9 18 15 12 9 6"></polyline></svg>,
                award: <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style={iconStyle}><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>
            };
            return <span className={className}>{icons[name]}</span>;
        }

        function App() {
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (user) => {
                    setUser(user);
                    setIsLoading(false);
                });
                return () => unsubscribe();
            }, []);

            if (isLoading) {
                return <LoadingScreen />;
            }
            
            if (!user) {
                return <LoginPage />;
            }

            return <SprintDashboard user={user} />;
        }
        
        function LoginPage() {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isSigningUp, setIsSigningUp] = useState(false);
            const [error, setError] = useState('');

            const handleAuth = async (e) => {
                e.preventDefault();
                setError('');
                try {
                    if (isSigningUp) {
                        await createUserWithEmailAndPassword(auth, email, password);
                    } else {
                        await signInWithEmailAndPassword(auth, email, password);
                    }
                } catch (err) {
                    setError(err.message);
                }
            };
            
            return (
                 <div className="flex items-center justify-center min-h-screen bg-gray-100">
                    <div className="w-full max-w-md p-8 space-y-8 bg-white rounded-2xl shadow-lg">
                        <h2 className="text-3xl font-bold text-center text-gray-900">{isSigningUp ? 'Create Account' : 'Sign In'}</h2>
                        <form className="mt-8 space-y-6" onSubmit={handleAuth}>
                             {error && <p className="p-3 bg-red-100 text-red-700 rounded-lg">{error}</p>}
                            <div className="rounded-md shadow-sm -space-y-px">
                                <div>
                                    <input id="email-address" name="email" type="email" autoComplete="email" required value={email} onChange={e => setEmail(e.target.value)} className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm" placeholder="Email address" />
                                </div>
                                <div>
                                    <input id="password" name="password" type="password" autoComplete="current-password" required value={password} onChange={e => setPassword(e.target.value)} className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm" placeholder="Password" />
                                </div>
                            </div>
                            <div>
                                <button type="submit" className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    {isSigningUp ? 'Sign Up' : 'Sign In'}
                                </button>
                            </div>
                        </form>
                        <p className="text-sm text-center text-gray-600">
                            {isSigningUp ? 'Already have an account?' : "Don't have an account?"}
                            <button onClick={() => setIsSigningUp(!isSigningUp)} className="font-medium text-blue-600 hover:text-blue-500 ml-1">
                                {isSigningUp ? 'Sign In' : 'Sign Up'}
                            </button>
                        </p>
                    </div>
                 </div>
            );
        }

        function LoadingScreen() { return <div className="flex flex-col items-center justify-center h-screen bg-gray-100"><LoadingSpinner /><p className="text-xl text-gray-500 mt-4">Loading Sprint Tracker...</p></div>; }
        function LoadingSpinner() { return <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600"></div>; }

        function SprintDashboard({ user }) {
            const [sessions, setSessions] = useState([]);
            const [activeSessionId, setActiveSessionId] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [view, setView] = useState('home');
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [isCreateModalOpen, setIsCreateModalOpen] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => {
                if(!user) return;
                setIsLoading(true);
                const q = query(collection(db, `users/${user.uid}/sessions`), orderBy('date', 'desc'));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const sessionsData = snapshot.docs.map(doc => ({...doc.data(), id: doc.id}));
                    setSessions(sessionsData);
                     if (sessionsData.length > 0 && !activeSessionId) {
                        setActiveSessionId(sessionsData[0].id);
                    }
                    setIsLoading(false);
                });
                return () => unsubscribe();
            }, [user]);

            const handleCreateSession = async (name, date, track, weather, type) => {
                if (!user) return;
                const newSession = { name, date: new Date(date).toISOString(), sprints: [], id: Date.now().toString(), track, weather, notes: "", type };
                const docRef = await addDoc(collection(db, `users/${user.uid}/sessions`), newSession);
                setActiveSessionId(docRef.id);
                setView('logger');
                setIsCreateModalOpen(false);
            };

            const handleUpdateSession = async (sessionId, updatedData) => {
                 if (!user) return;
                const sessionRef = doc(db, `users/${user.uid}/sessions`, sessionId);
                await updateDoc(sessionRef, updatedData);
            };

            const handleDeleteSession = async (sessionId) => {
                 if (!user) return;
                let nextActiveId = null;
                const remainingSessions = sessions.filter(s => s.id !== sessionId);
                if (activeSessionId === sessionId && remainingSessions.length > 0) {
                    nextActiveId = remainingSessions[0].id;
                } else if(remainingSessions.length > 0) {
                     nextActiveId = remainingSessions[0].id;
                }
                
                await deleteDoc(doc(db, `users/${user.uid}/sessions`, sessionId));

                setActiveSessionId(nextActiveId);
                 if (remainingSessions.length === 0) {
                    setView('home');
                }
            };

            const handleAddSprint = (sprintData) => {
                const session = sessions.find(s => s.id === activeSessionId);
                if (!session) return;
                const updatedSprints = [...(session.sprints || []), sprintData];
                handleUpdateSession(activeSessionId, {sprints: updatedSprints});
            };

            const handleUpdateSprint = (sprintToUpdate) => {
                const session = sessions.find(s => s.id === activeSessionId);
                if (!session) return;
                const updatedSprints = (session.sprints || []).map(s => s.id === sprintToUpdate.id ? sprintToUpdate : s);
                handleUpdateSession(activeSessionId, { sprints: updatedSprints });
            };
            
            const handleDeleteSprint = (sprintToDelete) => {
                const session = sessions.find(s => s.id === activeSessionId);
                if (!session) return;
                const updatedSprints = (session.sprints || []).filter(s => s.id !== sprintToDelete.id);
                handleUpdateSession(activeSessionId, { sprints: updatedSprints });
            };

            const handleGoToSession = (id) => { 
                setActiveSessionId(id); 
                setView('logger');
                setIsSidebarOpen(false); 
            };
            
            const filteredSessions = useMemo(() => {
                if (!searchTerm.trim()) {
                    return sessions; 
                }
                const searchDistance = parseInt(searchTerm, 10);
                if (isNaN(searchDistance)) {
                    return sessions;
                }
            
                return sessions.filter(session => {
                    return (session.sprints || []).some(sprint => sprint.distance === searchDistance);
                });
            }, [sessions, searchTerm]);
            
            const activeSession = sessions.find(s => s.id === activeSessionId);
            const MainContent = () => {
                switch(view) {
                    case 'home':
                        return <HomePage sessions={sessions} onGoToSession={handleGoToSession} setView={setView} setIsCreateModalOpen={setIsCreateModalOpen} />;
                    case 'calendar': 
                        return <CalendarPage sessions={sessions} onSessionSelect={handleGoToSession} setView={setView} />;
                    case 'bests':
                        return <PersonalBestsPage sessions={sessions} />
                    case 'logger':
                    default: 
                        if (activeSession) {
                           return <SprintLogger session={activeSession} onAddSprint={handleAddSprint} onUpdateSprint={handleUpdateSprint} onDeleteSprint={handleDeleteSprint} onUpdateSession={handleUpdateSession} />
                        }
                        return <HomePage sessions={sessions} onGoToSession={handleGoToSession} setView={setView} setIsCreateModalOpen={setIsCreateModalOpen} />;
                }
            }
            
            const handleLogout = () => {
                signOut(auth);
            }

            if (isLoading) return <LoadingScreen />;

            return (
                <div className="relative min-h-screen lg:flex">
                    {isSidebarOpen && <div className="fixed inset-0 bg-black bg-opacity-50 z-10 lg:hidden" onClick={() => setIsSidebarOpen(false)}></div>}
                    <aside className={`fixed top-0 left-0 h-full w-4/5 md:w-1/3 bg-gray-50/80 backdrop-blur-xl border-r border-gray-200 p-4 lg:p-6 flex flex-col scrollbar-thin transform transition-transform duration-300 ease-in-out z-20 lg:relative lg:w-1/3 lg:translate-x-0 lg:bg-gray-50 lg:border-r lg:border-gray-200 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                        <h1 className="text-2xl font-bold text-gray-900 mb-4">Sprint Tracker</h1>
                        <button onClick={() => setIsCreateModalOpen(true)} className="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center mb-4 hover:bg-blue-700 transition">
                            <Icon name="plus" size={20} className="mr-2"/>
                            <span>New Session</span>
                        </button>
                        <div className="mb-4">
                            <input
                                type="text"
                                placeholder="Search sessions by distance..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                className="w-full bg-white text-gray-900 p-3 rounded-lg border-2 border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none"
                            />
                        </div>
                        {isLoading ? <LoadingSpinner /> : <SessionList sessions={filteredSessions} activeSessionId={activeSessionId} onSelectSession={handleGoToSession} onUpdate={handleUpdateSession} onDelete={handleDeleteSession} />}
                         <div className="mt-auto pt-4">
                            <button onClick={handleLogout} className="w-full text-left p-3 rounded-xl hover:bg-gray-200 text-gray-700 font-semibold flex items-center">
                                <Icon name="logOut" className="mr-3" />
                                Logout
                            </button>
                         </div>
                    </aside>

                    <main className="flex-1 p-4 lg:p-8 overflow-y-auto scrollbar-thin bg-white pb-24 lg:pb-8">
                        <header className="flex justify-between items-center mb-6 lg:hidden">
                            <button onClick={() => setIsSidebarOpen(true)} className="p-2 rounded-lg bg-gray-100 hover:bg-gray-200"><Icon name="menu" size={24} /></button>
                                <h1 className="text-xl font-semibold text-gray-800">Sprint Tracker</h1>
                            <div className="w-10"></div>
                        </header>
                        <MainContent />
                    </main>

                    <footer className="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-xl border-t border-gray-200 lg:hidden">
                         <nav className="flex justify-around items-center h-16">
                                <button onClick={() => setView('home')} className={`flex flex-col items-center justify-center space-y-1 w-1/5 ${view === 'home' ? 'text-blue-600' : 'text-gray-500'}`}>
                                    <Icon name="home" size={24}/>
                                    <span className="text-xs font-semibold">Home</span>
                                </button>
                                <button onClick={() => setView('logger')} className={`flex flex-col items-center justify-center space-y-1 w-1/5 ${view === 'logger' && activeSessionId ? 'text-blue-600' : 'text-gray-500'}`} disabled={!activeSessionId}>
                                    <Icon name="timer" size={24}/>
                                    <span className="text-xs font-semibold">Logger</span>
                                </button>
                                <div className="w-1/5 flex justify-center">
                                    <button onClick={() => setIsCreateModalOpen(true)} className="bg-blue-600 text-white rounded-full h-16 w-16 flex items-center justify-center shadow-lg -mt-8 border-4 border-white">
                                        <Icon name="plus" size={32}/>
                                    </button>
                                </div>
                                <button onClick={() => setView('bests')} className={`flex flex-col items-center justify-center space-y-1 w-1/5 ${view === 'bests' ? 'text-blue-600' : 'text-gray-500'}`}>
                                    <Icon name="award" size={24}/>
                                    <span className="text-xs font-semibold">Bests</span>
                                </button>
                                <button onClick={() => setView('calendar')} className={`flex flex-col items-center justify-center space-y-1 w-1/5 ${view === 'calendar' ? 'text-blue-600' : 'text-gray-500'}`}>
                                    <Icon name="calendar" size={24}/>
                                    <span className="text-xs font-semibold">Calendar</span>
                                </button>
                        </nav>
                    </footer>
                    
                    {isCreateModalOpen && <SessionCreatorModal onCreateSession={handleCreateSession} onClose={() => setIsCreateModalOpen(false)} />}
                </div>
            );
        }

        // ... (The rest of the components remain the same, so they are omitted for brevity, but they exist in the full code)
        function HomePage({ sessions, onGoToSession, setView, setIsCreateModalOpen }) {
            const latestSession = sessions && sessions.length > 0 ? sessions[0] : null;

            if (!latestSession) {
                return (
                    <div className="flex flex-col items-center justify-center h-full text-center p-8 bg-white rounded-2xl shadow-sm">
                        <Icon name="timer" size={48} className="text-blue-500 mb-4" />
                        <h2 className="text-2xl font-bold text-gray-800 mb-2">Welcome to Sprint Tracker!</h2>
                        <p className="text-gray-500 mb-6">Track your sprint sessions, monitor progress, and view personal bests.</p>
                        <button onClick={() => setIsCreateModalOpen(true)} className="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition">
                            Create First Session
                        </button>
                    </div>
                );
            }

            return (
                <div className="bg-white p-4 sm:p-6 rounded-2xl">
                    <h2 className="text-2xl sm:text-3xl font-bold mb-4 text-gray-900">Latest Session</h2>
                    <div className="bg-gray-50 p-6 rounded-xl border border-gray-200">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <h3 className="text-xl font-bold text-gray-800">{latestSession.name}</h3>
                                <p className="text-sm text-gray-500">{new Date(latestSession.date).toLocaleDateString()}</p>
                            </div>
                            <button onClick={() => onGoToSession(latestSession.id)} className="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition whitespace-nowrap">
                                View Session
                            </button>
                        </div>
                        <div>
                            <h4 className="font-semibold text-gray-700 mb-2">Sprints Logged:</h4>
                            {(latestSession.sprints && latestSession.sprints.length > 0) ? (
                                <ul className="space-y-2">
                                    {latestSession.sprints.slice(0, 5).map(sprint => (
                                        <li key={sprint.id} className="flex justify-between items-center bg-white p-3 rounded-lg">
                                            <p className="font-semibold">{sprint.distance}m <span className="text-xs text-gray-500">({sprint.startType})</span></p>
                                            <p className="font-mono text-blue-600">{sprint.time.toFixed(2)}s</p>
                                        </li>
                                    ))}
                                    {latestSession.sprints.length > 5 && <li className="text-center text-sm text-gray-500 pt-2">...and {latestSession.sprints.length - 5} more.</li>}
                                </ul>
                            ) : (
                                <p className="text-gray-500">No sprints logged in this session yet.</p>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function PersonalBestsPage({ sessions }) {
             return (
                 <div className="bg-white p-4 sm:p-6 rounded-2xl">
                    <h2 className="text-2xl sm:text-3xl font-bold mb-4 text-gray-900">Personal Bests</h2>
                     <PersonalBests sessions={sessions} />
                </div>
            )
        }

        function SessionCreatorModal({ onCreateSession, onClose }) {
            const [name, setName] = useState('');
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
            const [track, setTrack] = useState('');
            const [mapUrl, setMapUrl] = useState('');
            const [weather, setWeather] = useState('');
            const [sessionType, setSessionType] = useState('Training');
            
            useEffect(() => {
                let isMounted = true;
                const controller = new AbortController();

                const fetchWeather = (lat, lon) => {
                    setWeather('Fetching weather...');
                    fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,wind_speed_10m`, { signal: controller.signal })
                        .then(response => response.json())
                        .then(data => {
                            if (isMounted) {
                                if (data && data.current) {
                                    const temp = data.current.temperature_2m;
                                    const wind = data.current.wind_speed_10m;
                                    setWeather(`Current Weather: ${temp}°C, ${wind} km/h wind`);
                                } else {
                                    setWeather('Could not fetch weather.');
                                }
                            }
                        })
                        .catch(error => {
                            if (error.name !== 'AbortError') {
                                console.error("Weather fetch error:", error);
                                if (isMounted) {
                                    setWeather('Could not fetch weather.');
                                }
                            }
                        });
                };
                
                const selectedTrackObject = ukAthleticTracks.find(t => typeof t === 'object' && t.name === track);

                if (selectedTrackObject) {
                    fetchWeather(selectedTrackObject.latitude, selectedTrackObject.longitude);
                    const encodedTrack = encodeURIComponent(track + ', UK');
                    if (isMounted) {
                       setMapUrl(`https://maps.google.com/maps?q=${encodedTrack}&t=&z=13&ie=UTF8&iwloc=&output=embed`);
                    }
                } else {
                     if (isMounted) {
                        setWeather('');
                        setMapUrl('');
                    }
                }

                return () => {
                    isMounted = false;
                    controller.abort();
                };
            }, [track]);


            const handleSubmit = (e) => { e.preventDefault(); if(name.trim()){ onCreateSession(name.trim(), date, track, weather, sessionType); }};
            
            return (<div className="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                <div className="bg-white border border-gray-200 rounded-2xl shadow-2xl p-6 w-full max-w-md">
                    <form onSubmit={handleSubmit}>
                        <h3 className="text-xl font-bold mb-4 text-gray-900">Create New Session</h3>
                        <div className="space-y-4">
                            <div>
                               <label htmlFor="session-name" className="block text-sm font-medium text-gray-700 mb-1">Session Name</label>
                               <input id="session-name" type="text" value={name} onChange={(e) => setName(e.target.value)} placeholder="e.g., Velocity Day" className="w-full bg-gray-100 text-gray-900 h-12 px-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                            </div>
                            <div>
                               <label htmlFor="session-date" className="block text-sm font-medium text-gray-700 mb-1">Date</label>
                               <input id="session-date" type="date" value={date} onChange={(e) => setDate(e.target.value)} className="w-full bg-gray-100 text-gray-900 h-12 px-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none" />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Session Type</label>
                                <div className="flex space-x-4">
                                    <label className="flex items-center">
                                        <input type="radio" value="Training" checked={sessionType === 'Training'} onChange={(e) => setSessionType(e.target.value)} className="form-radio h-4 w-4 text-blue-600"/>
                                        <span className="ml-2 text-gray-700">Training</span>
                                    </label>
                                    <label className="flex items-center">
                                        <input type="radio" value="Race" checked={sessionType === 'Race'} onChange={(e) => setSessionType(e.target.value)} className="form-radio h-4 w-4 text-blue-600"/>
                                        <span className="ml-2 text-gray-700">Race</span>
                                    </label>
                                </div>
                            </div>
                             <div>
                               <label htmlFor="session-track" className="block text-sm font-medium text-gray-700 mb-1">Track (Optional)</label>
                               <select id="session-track" value={track} onChange={(e) => setTrack(e.target.value)} className="w-full bg-gray-100 text-gray-900 h-12 px-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none">
                                 <option value="">Select a track</option>
                                 {ukAthleticTracks.map(trackItem => {
                                     const trackName = typeof trackItem === 'string' ? trackItem : trackItem.name;
                                     return <option key={trackName} value={trackName}>{trackName}</option>
                                 })}
                               </select>
                            </div>
                            {weather && (
                                <div className="mt-2 pl-1">
                                    <p className="text-sm text-gray-600">{weather}</p>
                                </div>
                            )}
                            {mapUrl && (
                                <div className="mt-4">
                                    <iframe
                                        width="100%"
                                        height="200"
                                        frameBorder="0"
                                        style={{ border: 0, borderRadius: '0.75rem' }}
                                        src={mapUrl}
                                        allowFullScreen="">
                                    </iframe>
                                </div>
                            )}
                        </div>
                        <div className="flex justify-end space-x-4 mt-6">
                            <button type="button" onClick={onClose} className="px-6 py-2 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 transition text-gray-800">Cancel</button>
                            <button type="submit" className="px-6 py-2 rounded-lg font-semibold bg-blue-600 hover:bg-blue-700 transition text-white">Create</button>
                        </div>
                    </form>
                </div>
            </div>);
        }

        function SessionList({ sessions, activeSessionId, onSelectSession, onUpdate, onDelete}) {
            const [isOpen, setIsOpen] = useState(true);
            const [editingId, setEditingId] = useState(null);
            const [confirmDeleteId, setConfirmDeleteId] = useState(null);
            const handleUpdate = (id, newName) => { if(newName.trim()) onUpdate(id, { name: newName.trim() }); setEditingId(null); };
            return (
                <div className="flex-grow mt-6">
                    <div className="flex justify-between items-center text-left text-lg font-bold text-gray-900 mb-3"><button onClick={() => setIsOpen(!isOpen)} className="flex items-center text-gray-900">Sessions {isOpen ? <Icon name="chevronUp" className="ml-2" /> : <Icon name="chevronDown" className="ml-2" />}</button></div>
                    {isOpen && (<>
                        {sessions.length === 0 ? <p className="text-gray-500 text-center py-4">No sessions found.</p> :
                        <ul className="space-y-2">
                            {sessions.map(session => <li key={session.id}>
                                {editingId === session.id ? (<div className="bg-white p-2 rounded-lg"><input type="text" defaultValue={session.name} autoFocus onBlur={(e) => handleUpdate(session.id, e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleUpdate(session.id, e.target.value)} className="w-full bg-gray-200 p-2 rounded-lg"/></div>) :
                                (<div className={`group w-full text-left p-3 rounded-xl transition flex justify-between items-center ${activeSessionId === session.id ? 'bg-blue-100 text-blue-700' : 'hover:bg-gray-200 text-gray-700'}`}>
                                    <button onClick={() => onSelectSession(session.id)} className="flex-grow text-left">
                                        <p className="font-semibold">{session.name}</p>
                                        <div className="flex items-center space-x-2">
                                            <p className="text-xs text-gray-500">{new Date(session.date).toLocaleDateString()}</p>
                                            {session.type && <span className={`text-xs px-2 py-0.5 rounded-full ${session.type === 'Race' ? 'bg-purple-200 text-purple-800' : 'bg-green-200 text-green-800'}`}>{session.type}</span>}
                                        </div>
                                    </button>
                                    <div className="flex opacity-0 group-hover:opacity-100 transition-opacity">
                                        <button onClick={() => setEditingId(session.id)} className="p-1 hover:text-gray-900"><Icon name="edit" size={16}/></button>
                                        <button onClick={() => setConfirmDeleteId(session.id)} className="p-1 hover:text-red-500"><Icon name="trash2" size={16}/></button>
                                    </div>
                                </div>)}
                            </li>)}
                        </ul>}
                    </>)}
                    {confirmDeleteId && <ConfirmationModal title="Delete Session?" message="This action is permanent." onConfirm={() => { onDelete(confirmDeleteId); setConfirmDeleteId(null); }} onCancel={() => setConfirmDeleteId(null)} />}
                </div>
            );
        }
        
        function CalendarPage({sessions, onSessionSelect, setView}) {
            const [selectedDate, setSelectedDate] = useState(new Date());
            const sessionsOnDate = useMemo(() => sessions.filter(s => new Date(s.date).toDateString() === selectedDate.toDateString()), [sessions, selectedDate]);
            const handleSelectAndLog = (sessionId) => { onSessionSelect(sessionId); setView('logger'); };
            return (
                <div className="space-y-8">
                    <CalendarView sessions={sessions} selectedDate={selectedDate} onDateChange={setSelectedDate} />
                    <div>
                        <h3 className="text-xl font-bold text-gray-900 mb-4">Sessions on {selectedDate.toLocaleDateString()}</h3>
                        {sessionsOnDate.length > 0 ? (
                            <ul className="space-y-3">
                                {sessionsOnDate.map(session => (
                                    <li key={session.id} onClick={() => handleSelectAndLog(session.id)} className="bg-white p-4 rounded-xl cursor-pointer hover:bg-gray-50 transition border border-gray-200">
                                        <p className="font-semibold text-blue-600">{session.name}</p>
                                        <p className="text-sm text-gray-500">{session.sprints?.length || 0} sprints logged.</p>
                                    </li>
                                ))}
                            </ul>
                        ) : (
                            <p className="text-gray-500 text-center py-8">No sessions on this day.</p>
                        )}
                    </div>
                </div>
            );
        }

        function CalendarView({ sessions, selectedDate, onDateChange }) {
            const [currentDate, setCurrentDate] = useState(new Date());
            const sessionDates = useMemo(() => new Set(sessions.map(s => new Date(s.date).toDateString())), [sessions]);
            const changeMonth = (amount) => setCurrentDate(prev => new Date(prev.getFullYear(), prev.getMonth() + amount, 1));
            const { month, year } = { month: currentDate.getMonth(), year: currentDate.getFullYear() };
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
            const blanks = Array.from({ length: firstDay });
            const weekDays = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            return (
                <div className="bg-white p-4 rounded-2xl border border-gray-200">
                    <div className="flex justify-between items-center mb-4"><button onClick={() => changeMonth(-1)} className="p-2 rounded-full hover:bg-gray-100 transition"><Icon name="chevronLeft" size={20} /></button><h3 className="font-bold text-lg text-gray-800">{new Intl.DateTimeFormat('en-US', { month: 'long', year: 'numeric' }).format(currentDate)}</h3><button onClick={() => changeMonth(1)} className="p-2 rounded-full hover:bg-gray-100 transition"><Icon name="chevronRight" size={20} /></button></div>
                    <div className="grid grid-cols-7 gap-2 text-center text-xs text-gray-500">{weekDays.map((day, index) => <div key={index} className="font-semibold h-9 w-9 flex justify-center items-center">{day}</div>)}</div>
                    <div className="grid grid-cols-7 gap-2 mt-2">
                        {blanks.map((_, i) => <div key={`b-${i}`} />)}
                        {days.map(day => {
                            const thisDate = new Date(year, month, day);
                            const isSelected = selectedDate && thisDate.toDateString() === selectedDate.toDateString();
                            const hasSession = sessionDates.has(thisDate.toDateString());
                            const baseClasses = "h-9 w-9 text-sm flex items-center justify-center rounded-full transition cursor-pointer relative";
                            const stateClasses = isSelected ? "bg-blue-600 text-white font-bold" : (thisDate.toDateString() === new Date().toDateString() ? "bg-gray-200" : "hover:bg-gray-100");
                            return <div key={day} className={`${baseClasses} ${stateClasses}`} onClick={() => onDateChange(thisDate)}>{day}{hasSession && <div className="absolute bottom-1.5 h-1.5 w-1.5 bg-blue-500 rounded-full" />}</div>;
                        })}
                    </div>
                </div>
            );
        }

        function SprintLogger({ session, sessions, onAddSprint, onUpdateSprint, onDeleteSprint, onUpdateSession }) {
            const [distance, setDistance] = useState(100);
            const [time, setTime] = useState('');
            const [startType, setStartType] = useState('Standing');
            const [rest, setRest] = useState('');
            const [notes, setNotes] = useState(session.notes || '');

            useEffect(() => {
                setNotes(session.notes || '');
            }, [session.id, session.notes]);
            
            const handleNotesBlur = () => {
                onUpdateSession(session.id, { notes: notes });
            };

            const handleSubmit = (e) => { 
                e.preventDefault(); 
                const timeValue = parseFloat(time); 
                const restValue = parseInt(rest, 10);
                if (!isNaN(timeValue) && timeValue > 0) { 
                    onAddSprint({ id: Date.now(), distance: Number(distance), time: timeValue, startType: startType, rest: isNaN(restValue) ? 0 : restValue }); 
                    setTime(''); 
                    setRest('');
                } 
            };
            
            return (
                <div className="bg-white p-4 sm:p-6 rounded-2xl">
                    <h2 className="text-2xl sm:text-3xl font-bold mb-1 text-gray-900">{session.name}</h2>
                    <p className="text-sm text-gray-500 mb-1">Date: {new Date(session.date).toLocaleDateString()}</p>
                    {session.track && <p className="text-sm text-gray-500">Track: {session.track}</p>}
                    {session.weather && <p className="text-sm text-gray-500 mb-8">Weather: {session.weather}</p>}
                    {(!session.track && !session.weather) && <div className="mb-8"></div>}


                    <form onSubmit={handleSubmit} className="mb-8 p-4 sm:p-6 bg-gray-50 rounded-xl">
                        <div className="grid md:grid-cols-2 gap-6 items-center">
                            <div>
                                <label htmlFor="distance" className="block text-lg font-medium mb-2 text-gray-700">Distance: <span className="font-bold text-blue-600">{distance}m</span></label>
                                <input id="distance" type="range" min="20" max="400" step="10" value={distance} onChange={(e) => setDistance(e.target.value)} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-thumb"/>
                            </div>
                            <div className="flex items-end space-x-2">
                                <div className="flex-grow">
                                    <label htmlFor="time" className="block text-lg font-medium mb-2 text-gray-700">Time (s)</label>
                                    <input id="time" type="number" step="0.01" value={time} onChange={(e) => setTime(e.target.value)} placeholder="e.g., 12.54" className="w-full bg-white text-gray-900 p-3 rounded-lg border-2 border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none" required/>
                                </div>
                                <div className="flex-grow">
                                    <label htmlFor="rest" className="block text-lg font-medium mb-2 text-gray-700">Rest (min)</label>
                                    <input id="rest" type="number" value={rest} onChange={(e) => setRest(e.target.value)} placeholder="e.g., 5" className="w-full bg-white text-gray-900 p-3 rounded-lg border-2 border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none" />
                                </div>
                                <button type="submit" className="h-[52px] px-4 sm:px-6 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition flex items-center justify-center self-end"><Icon name="plus" size={24} /></button>
                            </div>
                        </div>
                        <div className="mt-4">
                            <span className="block text-lg font-medium mb-2 text-gray-700">Start Type</span>
                            <div className="flex items-center space-x-6">
                               <label className="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="startType" value="Standing" checked={startType === 'Standing'} onChange={() => setStartType('Standing')} className="form-radio h-4 w-4 text-blue-600"/>
                                    <span className="text-gray-700">Standing</span>
                               </label>
                                <label className="flex items-center space-x-2 cursor-pointer">
                                    <input type="radio" name="startType" value="Rolling" checked={startType === 'Rolling'} onChange={() => setStartType('Rolling')} className="form-radio h-4 w-4 text-blue-600"/>
                                    <span className="text-gray-700">Rolling</span>
                               </label>
                            </div>
                        </div>
                    </form>

                    <div className="mb-8">
                        <h3 className="text-xl font-bold mb-4 text-gray-800">Session Notes</h3>
                        <textarea 
                            value={notes} 
                            onChange={(e) => setNotes(e.target.value)}
                            onBlur={handleNotesBlur}
                            placeholder="Add notes about this session..."
                            className="w-full bg-gray-50 text-gray-900 p-3 rounded-lg border-2 border-gray-200 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 focus:outline-none"
                            rows="4"
                        ></textarea>
                    </div>

                    <div><h3 className="text-xl font-bold mb-4 text-gray-800">Logged Sprints</h3><div className="max-h-96 overflow-y-auto pr-2 scrollbar-thin">{(session.sprints || []).length > 0 ? <ul className="space-y-3">{[...session.sprints].sort((a,b) => b.id - a.id).map(sprint => <SprintListItem key={sprint.id} sprint={sprint} onUpdate={onUpdateSprint} onDelete={onDeleteSprint} />)}</ul> : <p className="text-gray-500 text-center py-4">No sprints logged yet.</p>}</div></div>
                </div>
            );
        }

        function SprintListItem({ sprint, onUpdate, onDelete }) {
            const [isEditing, setIsEditing] = useState(false);
            const [confirmDelete, setConfirmDelete] = useState(false);
            const [editData, setEditData] = useState({ distance: sprint.distance, time: sprint.time, startType: sprint.startType || 'Standing', rest: sprint.rest || '' });
            
            const handleSave = () => { 
                const dist = parseInt(editData.distance, 10); 
                const time = parseFloat(editData.time); 
                const rest = parseInt(editData.rest, 10);
                if (!isNaN(dist) && !isNaN(time) && dist > 0 && time > 0) { 
                    onUpdate({ ...sprint, distance: dist, time: time, startType: editData.startType, rest: isNaN(rest) ? 0 : rest }); 
                    setIsEditing(false); 
                } 
            };

            if (isEditing) { 
                return (
                    <li className="bg-blue-50 p-3 rounded-lg space-y-3">
                        <div className="flex justify-between items-center gap-2">
                           <div className="flex items-center gap-2 flex-grow"><input type="number" value={editData.distance} onChange={e => setEditData({...editData, distance: e.target.value})} className="w-full bg-white p-1 rounded border border-gray-300"/><span>m</span></div>
                           <div className="flex items-center gap-2 flex-grow"><input type="number" step="0.01" value={editData.time} onChange={e => setEditData({...editData, time: e.target.value})} className="w-full bg-white p-1 rounded border border-gray-300"/><span>s</span></div>
                           <div className="flex items-center gap-2 flex-grow"><input type="number" value={editData.rest} onChange={e => setEditData({...editData, rest: e.target.value})} className="w-full bg-white p-1 rounded border border-gray-300"/><span>min</span></div>
                        </div>
                         <div className="flex justify-between items-center">
                            <div className="flex items-center space-x-4 text-sm">
                                <label className="flex items-center space-x-1 cursor-pointer">
                                    <input type="radio" name={`startType-${sprint.id}`} value="Standing" checked={editData.startType === 'Standing'} onChange={e => setEditData({...editData, startType: e.target.value})} className="form-radio h-4 w-4 text-blue-600"/>
                                    <span>S</span>
                                </label>
                                <label className="flex items-center space-x-1 cursor-pointer">
                                    <input type="radio" name={`startType-${sprint.id}`} value="Rolling" checked={editData.startType === 'Rolling'} onChange={e => setEditData({...editData, startType: e.target.value})} className="form-radio h-4 w-4 text-blue-600"/>
                                    <span>R</span>
                                </label>
                            </div>
                            <div className="flex gap-2"><button onClick={handleSave} className="p-1 hover:text-green-500"><Icon name="save" size={16}/></button><button onClick={() => setIsEditing(false)} className="p-1 hover:text-red-500"><Icon name="x" size={16}/></button></div>
                        </div>
                    </li>
                ); 
            }
            return (<li className="group flex justify-between items-center bg-white p-4 rounded-xl transition-all border border-gray-200">
                <div className="flex flex-col">
                    <p className="font-semibold text-gray-800">{sprint.distance}m</p>
                    {sprint.rest > 0 && <p className="text-xs text-gray-500">{sprint.rest} min rest</p>}
                </div>
                <div className="flex items-center gap-4">
                    <span className="text-xs bg-gray-200 text-gray-600 px-2 py-0.5 rounded-full">{sprint.startType || 'Standing'}</span>
                    <p className="text-blue-600 text-lg font-mono">{sprint.time.toFixed(2)}s</p>
                </div>
                <div className="flex opacity-0 group-hover:opacity-100 transition-opacity">
                    <button onClick={() => setIsEditing(true)} className="p-1 hover:text-gray-900"><Icon name="edit" size={16}/></button>
                    <button onClick={() => setConfirmDelete(true)} className="p-1 hover:text-red-500"><Icon name="trash2" size={16}/></button>
                </div>
                {confirmDelete && <ConfirmationModal title="Delete Sprint?" message={`Permanently delete the ${sprint.distance}m sprint?`} onConfirm={() => onDelete(sprint)} onCancel={() => setConfirmDelete(false)} />}
            </li>);
        }

        function PersonalBests({ sessions }) {
            const personalBests = useMemo(() => {
                if (!sessions) return [];
                const allSprints = sessions.flatMap(s => s.sprints || []);
                const bests = {};
                allSprints.forEach(sprint => {
                    const key = `${sprint.distance}m-${sprint.startType}`;
                    if (!bests[key] || sprint.time < bests[key].time) {
                        bests[key] = sprint;
                    }
                });
                return Object.values(bests).sort((a,b) => a.distance - b.distance);
            }, [sessions]);

            if (personalBests.length === 0) return null;

            return (
                <div className="mt-8">
                    <h3 className="text-xl font-bold mb-4 text-gray-800">Personal Bests</h3>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        {personalBests.map(pb => (
                                <div key={pb.id} className="bg-yellow-50 border border-yellow-200 p-4 rounded-xl">
                                    <p className="font-semibold text-yellow-800">{pb.distance}m ({pb.startType})</p>
                                    <p className="text-2xl font-bold text-yellow-900">{pb.time.toFixed(2)}s</p>
                                </div>
                        ))}
                    </div>
                </div>
            );
        }

        function ConfirmationModal({ title, message, onConfirm, onCancel }) {
            return (<div className="fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm flex items-center justify-center p-4 z-50"><div className="bg-white border border-gray-200 rounded-2xl shadow-2xl p-6 w-full max-w-sm text-center"><Icon name="alertTriangle" size={48} className="mx-auto text-red-500 mb-4" /><h3 className="text-xl font-bold text-gray-900 mb-2">{title}</h3><p className="text-gray-500 mb-6">{message}</p><div className="flex justify-center space-x-4"><button onClick={onCancel} className="px-6 py-2 rounded-lg font-semibold bg-gray-200 hover:bg-gray-300 transition">Cancel</button><button onClick={onConfirm} className="px-6 py-2 rounded-lg font-semibold bg-red-600 hover:bg-red-700 text-white transition">Confirm</button></div></div></div>);
        }
        
        window.onload = function() {
            ReactDOM.render(<App />, document.getElementById('root'));
        }
    </script>
</body>
</html>
